<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>COG Test</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/georaster/dist/georaster.browserify.min.js"></script>
  <script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
  <style>html,body,#map{height:100%;margin:0}</style>
</head>
<body>
<div id="map"></div>
<script>
(async () => {
  const url = "https://aeromap.io/201109S_geo_COG.tif"; // direct R2 custom domain
  const map = L.map("map").setView([0,0], 2);
  L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  const ab = await (await fetch(url, {mode:"cors"})).arrayBuffer();
  const georaster = await parseGeoraster(ab);
  const layer = new GeoRasterLayer({
    georaster,
    resolution: 128,
    pixelValuesToColorFn: v => v && v[0]!=null ? `rgb(${Math.max(0,Math.min(255,v[0]))},${Math.max(0,Math.min(255,v[0]))},${Math.max(0,Math.min(255,v[0]))})` : null
  }).addTo(map);
  map.fitBounds(layer.getBounds());
})();
</script>
</body>
</html>
