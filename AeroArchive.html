<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>DFW Start, Full TIFF View</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const titiler = "https://titiler-production.up.railway.app";
const encodedCogUrl =
  "https%3A%2F%2Fpub-099103561dfc47f8935d399c2cfb9380.r2.dev%2F201309S_geo_COG.tif";

// Rough DFW bounding box and center
const dfwBounds = L.latLngBounds(
  [32.3, -98.0],  // SW
  [33.3, -96.5]   // NE
);
const dfwCenter = dfwBounds.getCenter(); // [lat, lon]

// Create map – NO maxBounds now, so you can pan to entire TIFF
const map = L.map("map", {
  // we’ll adjust min/max zoom once we know them from cog/info
  worldCopyJump: false
});

// Start view over DFW at a reasonable zoom
map.setView(dfwCenter, 11);

// OSM basemap
const osm = L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {
    maxZoom: 22,
    noWrap: true
  }
).addTo(map);

// TiTiler tiles
const cogLayer = L.tileLayer(
  `${titiler}/cog/tiles/WebMercatorQuad/{z}/{x}/{y}.png?url=${encodedCogUrl}`,
  {
    tileSize: 256,
    maxZoom: 22,
    noWrap: true
  }
).addTo(map);

// Optional layer control
L.control.layers({ OSM: osm }, { "2013 Aerial": cogLayer }).addTo(map);

// Use cog/info ONLY to clamp zoom levels, not to set view
fetch(`${titiler}/cog/info?url=${encodedCogUrl}`)
  .then(r => r.json())
  .then(info => {
    console.log("COG info:", info);
    if (typeof info.minzoom === "number" && typeof info.maxzoom === "number") {
      // Clamp map zooms to what the raster supports
      map.setMinZoom(info.minzoom);
      map.setMaxZoom(info.maxzoom);

      // If our starting zoom is outside that range, bring it back in
      const currentZoom = map.getZoom();
      if (currentZoom < info.minzoom || currentZoom > info.maxzoom) {
        map.setZoom(info.minzoom + 1);
      }
    }
  })
  .catch(err => console.error("cog/info error:", err));
</script>
</body>
</html>
