<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>DFW Sectionals â€“ Layer Viewer</title>

  <!-- Leaflet core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ------------------------------
// TiTiler base URL
// ------------------------------
const titiler = "https://titiler-production.up.railway.app";

// ------------------------------
// Your COG list
// ------------------------------
const editions = [
  { filename: "201109N_geo_COG.tif", label: "2011 N" },
  { filename: "201109S_geo_COG.tif", label: "2011 S" },
  { filename: "201209N_geo_COG.tif", label: "2012 N" },
  { filename: "201209S_geo_COG.tif", label: "2012 S" },
  { filename: "201309N_geo_COG.tif", label: "2013 N" },
  { filename: "201309S_geo_COG.tif", label: "2013 S" },
  { filename: "201403_geo_COG.tif", label: "2014" },
  { filename: "201503_geo_COG.tif", label: "2015" },
  { filename: "201603_geo_COG.tif", label: "2016 Mar" },
  { filename: "201609_geo_COG.tif", label: "2016 Sep" }
];

// ------------------------------
// Helper: encode aeromap.io URL
// ------------------------------
function buildEncodedCogUrl(filename) {
  return encodeURIComponent(`https://aeromap.io/${filename}`);
}

// ------------------------------
// Build Leaflet map
// ------------------------------
const map = L.map("map", {
  center: [32.9, -97.3], // DFWish
  zoom: 10,
  worldCopyJump: false
});

// Base layer
const osm = L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {
    maxZoom: 22,
    noWrap: true
  }
).addTo(map);

// ------------------------------
// Create all COG layers
// ------------------------------
const overlayLayers = {};

editions.forEach((e, i) => {
  const encoded = buildEncodedCogUrl(e.filename);
  const layerUrl =
    `${titiler}/cog/tiles/WebMercatorQuad/{z}/{x}/{y}.png?url=${encoded}`;

  const layer = L.tileLayer(layerUrl, {
    tileSize: 256,
    maxZoom: 22,
    noWrap: true,
    opacity: 1
  });

  // Only turn on the FIRST one
  if (i === 0) {
    layer.addTo(map);
  }

  overlayLayers[e.label] = layer;
});

// ------------------------------
// Layer control
// ------------------------------
L.control.layers(
  { "OpenStreetMap": osm },
  overlayLayers,
  { collapsed: false }
).addTo(map);

</script>
</body>
</html>
