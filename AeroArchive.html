<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>DFW Start, Full TIFF View</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ------------------------------
// TiTiler base URL
// ------------------------------
const titiler = "https://titiler-production.up.railway.app";

// ------------------------------
// NEW: Custom aeromap.io URL builder
// ------------------------------
function buildEncodedCogUrl(filename) {
  const url = `https://aeromap.io/${filename}`;
  return encodeURIComponent(url);
}

// Example filename following your pattern:
// YYYYMM + optional extra text + _geo_COG.tif
// e.g. "201309S_geo_COG.tif" or "202409_revision_geo_COG.tif"
const filename = "201309S_geo_COG.tif";

const encodedCogUrl = buildEncodedCogUrl(filename);

// ------------------------------
// Rough DFW bounding box and center
// ------------------------------
const dfwBounds = L.latLngBounds(
  [32.3, -98.0],  // SW
  [33.3, -96.5]   // NE
);
const dfwCenter = dfwBounds.getCenter();

// ------------------------------
// Map (no maxBounds)
// ------------------------------
const map = L.map("map", {
  worldCopyJump: false
});
map.setView(dfwCenter, 11);

// ------------------------------
// OSM basemap
// ------------------------------
const osm = L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {
    maxZoom: 22,
    noWrap: true
  }
).addTo(map);

// ------------------------------
// TiTiler COG tile layer
// ------------------------------
const cogLayer = L.tileLayer(
  `${titiler}/cog/tiles/WebMercatorQuad/{z}/{x}/{y}.png?url=${encodedCogUrl}`,
  {
    tileSize: 256,
    maxZoom: 22,
    noWrap: true
  }
).addTo(map);

// Layer control
L.control.layers({ OSM: osm }, { ["COG " + filename]: cogLayer }).addTo(map);

// ------------------------------
// Fetch raster metadata and clamp zoom levels
// ------------------------------
fetch(`${titiler}/cog/info?url=${encodedCogUrl}`)
  .then(r => r.json())
  .then(info => {
    console.log("COG info:", info);
    if (typeof info.minzoom === "number" && typeof info.maxzoom === "number") {
      map.setMinZoom(info.minzoom);
      map.setMaxZoom(info.maxzoom);

      const currentZoom = map.getZoom();
      if (currentZoom < info.minzoom || currentZoom > info.maxzoom) {
        map.setZoom(info.minzoom + 1);
      }
    }
  })
  .catch(err => console.error("cog/info error:", err));

</script>
</body>
</html>
